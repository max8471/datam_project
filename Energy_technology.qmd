---
title: "Analysis of the trends in RD&D spending by energy technology (1974-2022)"
format:
  wordcount-html: default
author: "Disem Sula, Maximilien de La Ruelle"
editor: visual
warning: false
editor_options: 
  chunk_output_type: inline
---

```{r message=FALSE}
#| echo: false
#| message: false
here::i_am("R%D_project.Rproj")
library(here)
library(ggplot2)
library(tidyr)
library(dplyr)
library(vroom)
library(stringr)
library(knitr)
library(patchwork)
library(broom)
```

```{r}
#| message: false
#| echo: false
df<-vroom(here("IEA_Energy_RDD_selected_dataproject.csv"))
gdp<-vroom(here("WorldBank_GDP_data.csv"))

```

### Link to the github repository of this project

[Github repository](https://github.com/max8471/datam_project)

### Sources for the data

For the energy RD&D spending data : The data set is available [here](https://www.iea.org/data-and-statistics/data-product/energy-technology-rd-and-d-budget-database-2#overview) and download it by clicking on "selected data". Delete every sheet of the excel file except "public spending", and delete the first line of this sheet in order to have the years on the top row, then save it as a .csv file.

For the GDP data : Go to this [link](https://databank.worldbank.org/reports.aspx?source=2&series=NY.GDP.MKTP.CD&country#) and select years 1974-2022, then download the data as a .csv file.

### Description of the sources

#### International Energy agency

The International Energy Agency (IEA) is a pivotal organization founded in 1974 within the framework of the Organization for Economic Co-operation and Development (OECD). Comprising major energy consumers and producers globally, the IEA serves to enhance energy security, foster economic growth, and promote environmental sustainability. Its primary functions encompass collecting and analyzing energy data, conducting in-depth studies, and offering policy advice to member countries. The IEA also plays a critical role in coordinating emergency responses during energy supply disruptions.

Key to its mission is advocating for energy efficiency, renewable energy sources, and clean technologies, addressing the challenges of climate change. Through initiatives like the World Energy Outlook reports, the IEA provides comprehensive insights into global energy trends, projections, and policy scenarios. In recent years, the IEA has garnered attention for its commitment to advancing clean energy transitions and contributing to global climate goals. Through collaboration with governments, industries, and international organizations, the IEA actively works towards shaping a sustainable and secure energy future on a global scale.

#### World Bank

The World Bank, established in 1944, stands as a prominent international financial institution dedicated to supporting the development endeavors of nations worldwide. Its fundamental mission revolves around alleviating poverty and promoting sustainable economic development. Comprising two main institutions, the International Bank for Reconstruction and Development (IBRD) and the International Development Association (IDA), the World Bank provides financial assistance in the form of loans, grants, and expert guidance.

The World Bank engages in projects spanning various sectors, including education, health, infrastructure, agriculture, and energy, with a focus on fostering economic growth, reducing inequality, and improving living conditions. In the realm of energy, the World Bank plays a crucial role in financing and implementing projects that enhance access to energy in developing countries, promote renewable energy sources, and improve energy efficiency. Emphasizing sustainable development, environmental protection, and social inclusion, the World Bank's contributions extend beyond financial assistance to actively shaping a more equitable and sustainable global future through comprehensive development initiatives.

### Information about the initial data files

#### IEA data

```{r}
#| message: false
#| echo: false
n_rows_IEA=nrow(df)
n_cols_IEA=ncol(df)
col_names_IEA <- colnames(df)
country_names_IEA <- sapply(unique(df$Country), function(x) iconv(x, "latin1", "UTF-8"))
basic_info_IEA <- data.frame(
  Description = c("Number of Rows", "Number of Columns", "Column Names", "Countries"),
  Value = c(n_rows_IEA, n_cols_IEA, paste(col_names_IEA, collapse=", "), paste(country_names_IEA, collapse = ", ")))
kable(basic_info_IEA)
```

#### GDP data

```{r}
#| message: false
#| echo: false
col_names_GDP <- colnames(gdp)
n_rows_GDP=nrow(gdp)
n_cols_GDP=ncol(gdp)
country_names_GDP=unique(gdp$`Country Name`)
basic_info_GDP <- data.frame(
  Description = c("Number of Rows", "Number of Columns", "Column Names", "Countries"),
  Value = c(n_rows_GDP, n_cols_GDP, paste(col_names_GDP, collapse = ", "), paste(country_names_GDP, collapse = ", ")))
kable(basic_info_GDP)
```

### Filtering the data (IEA)

**Currency Standardization:** All monetary values in the dataset were set to USD using 2022 prices and PPP for uniformity.

```{r}
#| code-fold: true
#Choosing a single currency (USD 2022 prices and PPP), for the whole dataset
filtered_df <- df |>
  filter(Currency == "USD (2022 prices and PPP)")
```

**Timeframe Adjustment:** The dataset was restricted to the years up to 2022, removing data for the year 2023.

```{r}
#| code-fold: true
#Removing year 2023 and stop at year 2022 as for the GDP
filtered_df <- filtered_df[, -ncol(filtered_df)]
```

**Column Removal:** The 'Currency' column in the filtered dataset was removed as it became redundant after currency standardization.

```{r}
#| code-fold: true
#Removing the column Currency in filtered_df since it is not useful anymore
filtered_df <- subset(filtered_df, select = -Currency)
```

### Processing the GDP data to make it correctly mergeable with the IEA one

**Column Naming Standardization:** Only the year information was retained in the column names for GDP

```{r}
#| code-fold: true
#Only keeping the year in the column names of gdp
col_names <- colnames(gdp)

col_names[5:length(col_names)] <- substr(col_names[5:length(col_names)], 1, 4)

colnames(gdp) <- col_names
```

**Country names harmonization:** Three country names were standardized for consistency across datasets.

```{r}
#| code-fold: true
#Modifying 3 names of countries so everything is written with the same standards in both dataframes
gdp <- gdp |> mutate(`Country Name` = ifelse(`Country Name` == "Korea, Rep.", "Korea", `Country Name`))

gdp <- gdp |> mutate(`Country Name` = ifelse(`Country Name` == "Czechia", "Czech Republic", `Country Name`))

filtered_df <- filtered_df |> mutate(`Country` = ifelse(startsWith(`Country`,"Republic of T"), "Turkiye", `Country`))
```

**Filtered GDP Creation:** A new dataframe, 'filtered_gdp,' was created, containing GDP data only for countries present in the IEA dataset.

```{r}
#| code-fold: true
#Keeping the gdp only for the countries that appears in filtered_df, and storing it into a new dataframe named filtered_gdp
distinct_countries <- unique(filtered_df$Country)

filtered_gdp <- gdp[gdp$`Country Name` %in% distinct_countries, ]
```

**Columns Removal:** Columns with irrelevant or redundant information were removed to streamline the dataframe

```{r}
#| code-fold: true
#Now removing the columns that won't be useful for us
filtered_gdp <- subset(filtered_gdp, select = c(-`Series Name`, -`Series Code`, -`Country Code`))
```

**Column Name Adjustment:** The column name 'Country name' was changed to 'Country' for consistency with the naming convention in the IEA filtered dataframe.

```{r}
#| code-fold: true
#Changing the column name to Country from Country name
filtered_gdp <- filtered_gdp |>
  rename(Country = `Country Name`)
```

**Data Type Standardization:** Ensured that all data was in numerical format, facilitating seamless merging of datasets.

```{r, warning=FALSE}
#| code-fold: true
#Making sure all the data is numerical before merging
filtered_df <- filtered_df %>%
  mutate(across(-c(Country, Technology), ~as.numeric(gsub(",", ".", .))))

filtered_gdp <- filtered_gdp %>%
  mutate(across(-`Country`, ~as.numeric(gsub(",", ".", .))))
```

**Unit Standardization:** GDP values were converted to millions to align with the unit of R&D spending, both measured in millions.

```{r}
#| code-fold: true
#GDP in millions (as the R&D spending is in millions)
filtered_gdp <- filtered_gdp |>
  mutate(across(matches("^[12]"), ~./1000000))
```

### Merging the two datasets

**Integration of GDP as a Technology:** A new row was added for each country, treating GDP as a technological variable for comprehensive analysis.

```{r}
#| code-fold: true
#Adding a row for each country to include the GDP into the data as if it is a Technology
combined_df <- bind_rows(filtered_df, filtered_gdp) |>
  arrange(Country, Technology)
options(scipen = 999)
```

**Handling a clarity issue:** Renamed 'NA' entry to 'GDP' in column named "Technology" for clarity and completeness in the dataset

```{r}
#| code-fold: true
#Changing the name of the of the GDP appearing as "NA" to "GDP"
combined_df <- combined_df |>
  mutate(Technology = ifelse(is.na(Technology), "GDP", Technology))
```

## Research question

The global landscape of energy technology and its intersection with economic development have undergone profound transformations over the past five decades. As nations strive for sustainable energy solutions and economic growth, it becomes imperative to investigate the trajectory of energy technology advancements and the corresponding shifts in public Research, Development, and Deployment (RD&D) investments. This research aims to discern patterns, disparities, and potential correlations in the evolution of spending of RD&D on energy technologies among a set of countries over a 50-year span.

**Research Question:** The primary research question guiding this investigation is: "Has there been a discernible change in the energy technology landscape among countries and group of countries such as G7 and EU over the last 50 years, and how does this relate to the proportion of public RD&D spending in relation to their Gross Domestic Product (GDP)?"

The choice of groups like G7 and EU countries for this analysis stems from their global economic significance and shared commitment to addressing energy challenges. By delving into the energy technology trajectories of these nations, we aim to identify trends that may offer insights into the changes in economic structures and innovation ecosystems. Additionally, linking these technological advancements to the proportion of GDP allocated to public RD&D allows to make them comparable from one country to another.

To address the research question, a comprehensive longitudinal analysis will be conducted, spanning five decades from 1974 to 2022. Key variables to be examined include indicators of energy technology evolution, using the public expenditure on RD&D in different technologies to find the adoption of renewable energy sources, advancements in energy efficiency, and breakthroughs in emerging technologies. In parallel, the study will scrutinize each country's GDP and the corresponding public expenditure on RD&D in the energy sector allowing for the assessment of not only technological shifts but also the relative prioritization of energy research within each nation's economic landscape.

The anticipated outcomes of this research include a nuanced understanding of the changing dynamics in energy technology across countries and an exploration of the relationship between economic development and public RD&D spending.

As an introduction, here you will find the evolutions in RD&D spending in 3 major technologies (Nuclear power, fossil fuels and renewables energies) for 3 main areas (Europe, Asia and Oceania, Americas)

```{r}
#| echo: false
filtered_data_IEA_Europe <- combined_df |>
  filter(Country == "IEA Europe" & Technology %in% c("Fossil fuels", "Nuclear", "Renewables"))

filtered_data_IEA_Americas <- combined_df |>
  filter(Country == "IEA Americas" & Technology %in% c("Fossil fuels", "Nuclear", "Renewables"))

filtered_data_IEA_Asia_Oceania <- combined_df |>
  filter(Country == "IEA Asia Oceania" & Technology %in% c("Fossil fuels", "Nuclear", "Renewables"))
```

```{r}
#| echo: false
reshaped_IEA_Europe <- filtered_data_IEA_Europe |>
  pivot_longer(cols = c(starts_with("19"),starts_with("20")), names_to = "Year", values_to = "Value")

reshaped_IEA_Europe$Year <- as.numeric(reshaped_IEA_Europe$Year)

ggplot(reshaped_IEA_Europe, aes(x = Year, y = Value, color = Technology)) +
  geom_line() +
    scale_color_manual(values = c("Renewables" = "darkgreen", "Fossil fuels" = "brown", "Nuclear" = "purple"))+
  labs(title = "Europe - Temporal Trends in Energy RD&D Spending (1974-2022)",
       x = "Year",
       y = "Millions of 2022 USD",
       color = "Technology")




reshaped_IEA_Asia_Oceania <- filtered_data_IEA_Asia_Oceania |>
  pivot_longer(cols = c(starts_with("19"),starts_with("20")), names_to = "Year", values_to = "Value")

reshaped_IEA_Asia_Oceania$Year <- as.numeric(reshaped_IEA_Asia_Oceania$Year)

ggplot(reshaped_IEA_Asia_Oceania, aes(x = Year, y = Value, color = Technology)) +
  geom_line() +
    scale_color_manual(values = c("Renewables" = "darkgreen", "Fossil fuels" = "brown", "Nuclear" = "purple"))+
  labs(title = "Asia and Oceania - Temporal Trends in Energy RD&D Spending (1974-2022)",
       x = "Year",
       y = "Millions of 2022 USD",
       color = "Technology")



reshaped_IEA_Americas <- filtered_data_IEA_Americas |>
  pivot_longer(cols = c(starts_with("19"),starts_with("20")), names_to = "Year", values_to = "Value")

reshaped_IEA_Americas$Year <- as.numeric(reshaped_IEA_Americas$Year)

ggplot(reshaped_IEA_Americas, aes(x = Year, y = Value, color = Technology)) +
  geom_line() +
  scale_color_manual(values = c("Renewables" = "darkgreen", "Fossil fuels" = "brown", "Nuclear" = "purple"))+
  labs(title = "Americas - Temporal Trends in Energy RD&D Spending (1974-2022)",
       x = "Year",
       y = "Millions of 2022 USD",
       color = "Technology")
```

```{r}
#| echo: false
#| message: false
G7 <- c("France", "Italy", "Germany", "United States", "Japan", "United Kingdom", "Canada")
```

```{r}
#| echo: false
#| message: false
reshaped_df <- combined_df |>
  pivot_longer(cols = c(starts_with("19"),starts_with("20")), names_to = "Year", values_to = "Value")

reshaped_df$Year <- as.numeric(reshaped_df$Year)
```

## Analyzing the Correlation Between GDP and Public RD&D Spending
In our initial exploration, we sought to understand the relationship between a country's Gross Domestic Product (GDP) and the funds allocated to public Research, Development, and Deployment (RD&D) in the energy sector. We hypothesized that these two variables might exhibit a correlation, indicative of the economic commitment to energy-related research.
To investigate this, we performed a series of linear regressions for each year spanning 1974 to 2022, computing the R-squared values as a measure of the goodness of fit for the linear model. The R-squared values represent the proportion of the variation in the Total Budget (public RD&D spending) that can be explained by changes in GDP.

```{r}
#| echo: false
#| message: false
regression_df<-reshaped_df%>%
  filter(Technology %in% c("Total Budget", "GDP"))

r_squared_results <- data.frame(Year = numeric(), R_squared = numeric())
coefficients_results<-data.frame(Year=numeric(), Intercept=numeric(), Coefficient=numeric())

for (year in 1974:2022) {
  df_year <- regression_df %>%
    filter(Year == year) %>%
    select(-Year)

  total_budget_data <- df_year %>%
    filter(Technology == "Total Budget") %>%
    select(Country, Value)

  gdp_data <- df_year %>%
    filter(Technology == "GDP") %>%
    select(Country, Value)

  
  common_countries <- intersect(total_budget_data$Country, gdp_data$Country)

  total_budget_data <- total_budget_data %>%
    filter(Country %in% common_countries) %>%
    arrange(Country)

  gdp_data <- gdp_data %>%
    filter(Country %in% common_countries) %>%
    arrange(Country)
  
  lm_result <- lm(total_budget_data$Value ~ gdp_data$Value)

  r_squared <- summary(lm_result)$r.squared
  coefficients <- coefficients(lm_result)

  r_squared_results <- bind_rows(r_squared_results, data.frame(Year = year, R_squared = r_squared))
  coefficients_results <- bind_rows(coefficients_results, data.frame(Year = year, Intercept = coefficients[1], Coefficient = coefficients[2]))
}
```

```{r}
#| echo: false
#| message: false
ggplot(r_squared_results, aes(x = Year, y = R_squared)) +
  geom_line() +
  geom_point() +
  ylim(0,1) +
  labs(title = "R-squared values over the years 1974-2022",
       x = "Year",
       y = "R-squared")

```
Our findings, visualized in the graph titled "R-squared values over the years 1974-2022," revealed a consistent and significant correlation between GDP and Total Budget. The R-squared values have a mean of `r round(mean(r_squared_results$R_squared),digits=2)*100`%
and consistently exceeds `r round(min(r_squared_results$R_squared),digits=2)*100`%, indicating a substantial portion of the variability in public RD&D spending can be attributed to changes in GDP.

After establishing the consistent correlation between Gross Domestic Product (GDP) and Total Budget (public RD&D spending) across the years, we further investigated the dynamics at the extremes—1980 and 2002—by pinpointing the regression for the highest and the lowest R-squared values.

```{r}
#| echo: false
#| message: false
#| warning: false
df1980<-regression_df%>%
  filter(Year==1980)%>%
  select(-Year)%>%
  pivot_wider(names_from = Technology, values_from= Value)

ggplot(df1980, aes(x = GDP, y = `Total Budget`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "lightblue") +
  labs(title = "Regression Analysis: GDP vs Total Budget in 2022 USD (1980)", subtitle = "R-Squared = 99% ",
       x = "GDP",
       y = "Total Budget") +
  theme_minimal()
```

```{r}
#| echo: false
#| message: false
#| warning: false
df2002<-regression_df%>%
  filter(Year==2002)%>%
  select(-Year)%>%
  pivot_wider(names_from = Technology, values_from= Value)

ggplot(df2002, aes(x = GDP, y = `Total Budget`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "lightblue") +
  labs(title = "Regression Analysis: GDP vs Total Budget in 2022 USD (2002)",subtitle = "R-Squared = 68% ",
       x = "GDP",
       y = "Total Budget") +
  theme_minimal()
```

The upward-sloping line indicates a positive relationship between GDP and public RD&D spending. In this era, countries with higher GDP tended to allocate a larger budget to energy-related research.
But this snapshot doesn't give an exhaustive view of how this positive relationship between GDP and public RD&D spending evolved over the time. To do so, you will find below the evolution of the coefficient of the GDP in the regression.
```{r}
#| echo: false
#| message: false
ggplot(coefficients_results, aes(x = Year, y = Coefficient)) +
  geom_line() +
  geom_point() +
  labs(title = "Coefficient values over the years 1974-2022",
       x = "Year",
       y = "Coefficient")
```
The graph can be interpreted as following : In 1990, countries were spending, on average, .1% of their GDP in energy RD&D. In other words, an increase of 1000$ of the GDP implies that there is an additional dollar spent on energy RD&D.
This observation thus suggests a dynamic interplay between economic factors and government investments in energy-related research over the decades.
Indeed, we see that this proportion is growing very fast until 1980, reaching .45%, before drastically diminishing to .05% around 1995. Since then, the levels are quite constant.
It should be noted that the high rise in 2009 is mostly due to the recession caused by the financial crisis (a decrease in the GDP mechanically leads to an increase of the total budget when expressed as a percentage).


# Examining G7 Countries: Evolution of RD&D Spending and GDP Relationship

```{r}
#| echo: false
#| message: false
g7_summary_df0 <- reshaped_df %>%
  filter(Country %in% G7) %>%
  group_by(Year, Technology) %>%
  summarise(Spending = sum(ifelse(is.na(Value), 0, Value)), .groups = "drop")
```


Focusing our lens on the Group of Seven (G7) countries, we narrowed our analysis to key technologies, investigating how G7 countries allocated their resources to foster advancements in energy technologies. This detailed analysis will provide a more granular understanding of the technological trajectories that accompanied the observed financial dynamics.

```{r}
#| echo: false
#| message: false
#We have to create a data set with values normalized by the GDP
gdp_rows <- reshaped_df %>% filter(Technology == "GDP")

# Values are in %o (permille)
normalized_df <- reshaped_df %>%
  left_join(gdp_rows, by = c("Country", "Year"), suffix = c("", "_GDP")) %>%
  mutate(Value_normalized = Value*1000 / Value_GDP) %>%
  select(-Value_GDP,-Technology_GDP)
```

```{r}
#| echo: false
#| message: false
filtered_data_G7 <- normalized_df |>
  filter(Country %in% G7)
filtered_data_G7$Year <- as.numeric(filtered_data_G7$Year)
```

```{r}
#| echo: false
#| message: false
G7_gdp_rows <- g7_summary_df0 %>% filter(Technology=="GDP")
```

```{r}
#| echo: false
#| message: false
#Then normalize it the same way but for the G7 grouped data
G7_normalized <- g7_summary_df0 %>%
  left_join(G7_gdp_rows,by="Year",suffix=c("","_GDP")) %>%
  mutate(Spending_normalized=Spending*1000/Spending_GDP) %>%
  select(-Technology_GDP,-Spending_GDP)
```

## Normalizing Spending: Unveiling G7 Similarities

Recognizing the need to address potential distortions in our analysis caused by variations in the Gross Domestic Product (GDP) across G7 countries, we decided to normalize our spending values. The need of such a transformation is highlighted by the correlation between the two variables. This normalization was achieved by expressing the spending figures as permillages of the GDP, providing a more standardized measure and enabling a comparative analysis that considers each country's economic context.
To prove that this transformation was useful, we have conducted the same analysis on the R-squared than before, but now expressing the Total budget as a percentage of the GDP.

```{r}
#| echo: false
#| message: false
regression_df2<-normalized_df%>%
  filter(Technology %in% c("Total Budget", "GDP"))

r_squared_results2 <- data.frame(Year = numeric(), R_squared = numeric())
coefficients_results2<-data.frame(Year=numeric(), Intercept=numeric(), Coefficient=numeric())

for (year in 1974:2022) {
  df_year <- regression_df2 %>%
    filter(Year == year) %>%
    select(-Year)

  total_budget_data2 <- df_year %>%
    filter(Technology == "Total Budget") %>%
    select(Country, Value_normalized)

  gdp_data2 <- df_year %>%
    filter(Technology == "GDP") %>%
    select(Country, Value)

  
  common_countries2 <- intersect(total_budget_data2$Country, gdp_data2$Country)

  total_budget_data2 <- total_budget_data2 %>%
    filter(Country %in% common_countries2) %>%
    arrange(Country)

  gdp_data2 <- gdp_data2 %>%
    filter(Country %in% common_countries2) %>%
    arrange(Country)
  
  lm_result2 <- lm(total_budget_data2$Value_normalized ~ gdp_data2$Value)

  r_squared2 <- summary(lm_result2)$r.squared
  coefficients2 <- coefficients(lm_result2)

  r_squared_results2 <- bind_rows(r_squared_results2, data.frame(Year = year, R_squared = r_squared2))
  coefficients_results2 <- bind_rows(coefficients_results2, data.frame(Year = year, Intercept = coefficients2[1], Coefficient = coefficients2[2]))
}
```


```{r}
#| echo: false
#| message: false
merged_rsquared<-merge(r_squared_results,r_squared_results2, by = "Year")
ggplot(merged_rsquared, aes(x = Year)) +
  geom_line(aes(y=R_squared.x, color="darkred")) +
  geom_point(aes(y=R_squared.x, color="darkred"))+
  geom_line(aes(y=R_squared.y, color="steelblue"))+
  geom_point(aes(y=R_squared.y,color="steelblue"))+
  ylim(0,1) +
  labs(title = "R-squared values over the years 1974-2022",
       x = "Year",
       y = "R-squared")+
  theme(legend.position="none")
```
In blue, those are the post-normalization R-squared values (and pre-normalization in red for comparison purposes).
The values are now really low, being mostly very close to 0 despite a few higher values around 1980.
In addition of confirming that the transformation was useful, this tells us that since 2000, the size of an economy doesn't affect the proportion of its resources a government is willing to spend in energy RD&D.

This normalization allows us to focus on shared patterns, providing a more accurate representation of the group's collaborative efforts in public RD&D spending. As we move forward, this standardized approach will enhance our ability to discern collective trends in energy technology evolution within the G7, shedding light on the collaborative strides made by these economically influential nations.

We now present a series of graphs comparing public Research, Development, and Deployment (RD&D) spending across G7 countries in different technologies. These visualizations showcase spending expressed both as a permillage of the Gross Domestic Product (GDP) and in 2022 USD. The fact that for every technology, the countries are evolving together much more on the left graph than on the right graph underscores the efficiency of our spending normalization.





```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_nuclear<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Nuclear")

plot1nuke<-ggplot(filtered_data_G7_nuclear, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Nuclear",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2nuke<-ggplot(filtered_data_G7_nuclear, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Nuclear",
       x = "Year",
       y = "2022 USD",
       color = "Country")
combined_plot_nuke <- plot1nuke + plot2nuke + plot_layout(guides = "collect")&
  theme(legend.position = "top")
combined_plot_nuke
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_renewables<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Renewables")

plot1renew<-ggplot(filtered_data_G7_renewables, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Renewables",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2renew<-ggplot(filtered_data_G7_renewables, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Renewables",
       x = "Year",
       y = "2022 USD",
       color = "Country")
combined_plot_renewables <- plot1renew + plot2renew + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_renewables
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_energyefficiency<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Energy efficiency")

plot1nrgeff<-ggplot(filtered_data_G7_energyefficiency, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Energy efficiency",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2nrgeff<-ggplot(filtered_data_G7_energyefficiency, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Energy efficiency",
       x = "Year",
       y = "2022 USD",
       color = "Country")

combined_plot_nrgeff <- plot1nrgeff + plot2nrgeff + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_nrgeff
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_fossilfuels<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Fossil fuels")

plot1foss<-ggplot(filtered_data_G7_fossilfuels, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Fossil fuels",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2foss<-ggplot(filtered_data_G7_fossilfuels, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Fossil fuels",
       x = "Year",
       y = "2022 USD",
       color = "Country")

combined_plot_foss <- plot1foss + plot2foss + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_foss
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_Hydrogen<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Hydrogen and fuel cells")

plot1hydro<-ggplot(filtered_data_G7_Hydrogen, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Hydrogen and fuel cells",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2hydro<-ggplot(filtered_data_G7_Hydrogen, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Hydrogen and fuel cells",
       x = "Year",
       y = "2022 USD",
       color = "Country")

combined_plot_hydro <- plot1hydro + plot2hydro + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_hydro
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_othercrosscutting<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Other cross-cutting technologies/research")

plot1crosscut<-ggplot(filtered_data_G7_othercrosscutting, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Other cross-cutting technologies/research",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2crosscut<-ggplot(filtered_data_G7_othercrosscutting, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Other cross-cutting technologies/research",
       x = "Year",
       y = "2022 USD",
       color = "Country")

combined_plot_crosscut <- plot1crosscut + plot2crosscut + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_crosscut
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_Powerandstorage<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Other power and storage technologies")

plot1pow<-ggplot(filtered_data_G7_Powerandstorage, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Other power and storage technologies",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2pow<-ggplot(filtered_data_G7_Powerandstorage, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Other power and storage technologies",
       x = "Year",
       y = "2022 USD",
       color = "Country")

combined_plot_pow <- plot1pow + plot2pow + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_pow
```

```{r}
#| echo: false
#| message: false
#| warning: false
filtered_data_G7_totalbudget<- filtered_data_G7 |>
  filter(Country %in% G7 & Technology =="Total Budget")

plot1tot<-ggplot(filtered_data_G7_totalbudget, aes(x = Year, y = Value_normalized, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Total Budget",
       x = "Year",
       y = "%o of GDP",
       color = "Country")

plot2tot<-ggplot(filtered_data_G7_totalbudget, aes(x = Year, y = Value, group=Country, color=Country)) +
  geom_line() +
  labs(title = "G7 - Total Budget",
       x = "Year",
       y = "2022 USD",
       color = "Country")

combined_plot_tot <- plot1tot + plot2tot + plot_layout(guides = "collect")&
  theme(legend.position = "none")
combined_plot_tot
```

The similarities from one country to another will allow us to analyze the trends in spending at the G7 level while staying relevant, and the conclusions made will mostly be true at the country level too.

## Analyzing G7 Spending Trends in Energy Technologies

Having established a normalized and comparable framework for analyzing spending in public Research, Development, and Deployment (RD&D) across G7 countries, we now focus on the spending of G7 as a whole.

In the first graph, we observe variations in spending levels, with nuclear standing out as having a higher magnitude compared to other technologies. To provide a clearer picture of trends for the remaining technologies, a second graph excluding nuclear spending is provided.

The combined plots highlight intriguing patterns in G7 countries' spending on different energy technologies from 1974 to 2022. Notably, there was a peak in spending around 1980, followed by a significant decline until the mid-90s. Subsequently, a relatively linear trend emerged, punctuated by occasional fluctuations. This observation aligns with broader economic and political shifts during this period.

```{r}
#| echo: false
#| message: false
filtered_G7 <- G7_normalized |>
  filter(Technology %in% c("Fossil fuels", "Nuclear", "Renewables","Energy efficiency","Hydrogen and fuel cells","Other cross-cutting technologies/research","Other power and storage technologies"))

plot1g7tech<-ggplot(filtered_G7, aes(x = Year, y = Spending_normalized, color = Technology)) +
  geom_line()+
  labs(title = "Spending on various energy technologies for G7 (1974-2022)",
       x = "Year",
       y = "Spending (per millage of the GDP)",
       color = "Technology")

G7_wonuc <- G7_normalized |>
  filter(Technology %in% c("Fossil fuels", "Renewables","Energy efficiency","Hydrogen and fuel cells","Other cross-cutting technologies/research","Other power and storage technologies"))


plot2g7tech<-ggplot(G7_wonuc, aes(x = Year, y = Spending_normalized, color = Technology)) +
  geom_line(show.legend=FALSE) +
  labs(title = "Nuclear excluded",
       x = "Year",
       y = "Spending (per millage of the GDP)",
       color = "Technology")

combined_plot_g7tech <- (plot1g7tech + plot2g7tech) + plot_layout(guides = "collect")&
  theme(legend.position = "bottom")
combined_plot_g7tech
```

## Evolving Landscape of RD&D Spending: G7 Perspective

**Key Observations:**

- *Nuclear Energy Decline:*
There is a significant decline in the percentage of RD&D investment in nuclear energy technology. In 1974, nuclear spending accounted for approximately 74% of the total budget for energy technology RD&D. However, by 2022, this proportion had decreased to around 20%. This highlights a substantial shift in priorities away from nuclear technology within the G7 countries.

- *Rise of Energy Efficiency:*
Energy efficiency exhibits a consistent and remarkable upward trend in terms of percentage on the total budget. Starting at around 2% in 1974, it has steadily increased and reached almost 25% in 2022. This suggests a sustained commitment to improving energy efficiency and conservation efforts.

- *Steady Fossil Fuel Allocation:*
Fossil fuel RD&D spending has remained relatively steady over the years, with a slight decline. In the 1980s and 1990s, it accounted for around 14%, which reduced to an average of 7-8% in the 2016-2022 period. This indicates a steady but reduced emphasis on fossil fuel technologies within the G7 consortium.

- *Emergence of Hydrogen and Fuel Cells:*
Hydrogen and fuel cells technology, while starting from virtually 0% in the 1980s and 1990s, has seen an increase. It reached around 3-5% of the total budget in the 2016-2022 period, showcasing a growing interest in these technologies, albeit from a relatively small base. However, it is worth noting that France multiplied its hydrogen investment by 20 between 2021 and 2022, thus driving the rise at the G7 level. This means that conclusions should not be extended and applied to other G7 countries without further research.

- *Rising Role of Renewables:*
The percentage of spending on renewable energy technologies has experienced a substantial increase in the last two decades. Starting almost from 0% in 1974, it climbed to around 20% between 2008 and 2016, reflecting a heightened focus on sustainable and renewable energy solutions.

```{r}
#| echo: false
#| message: false
df_percent <- g7_summary_df0 %>%
  filter(Technology != "GDP" & Technology != "Total Budget" & Technology != "Unallocated") %>%
  group_by(Year) %>%
  mutate(Percentage = Spending / sum(Spending) * 100)

selected_years <- c(1974, 1984, 1994, 2008, 2016, 2022)
df_percent$YearGroup <- cut(df_percent$Year, breaks = c(-Inf, selected_years, Inf), labels = FALSE, include.lowest = TRUE)

ggplot(df_percent, aes(x = factor(YearGroup), y = Percentage, fill = Technology)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_x_discrete(labels = selected_years) +
  labs(title = "Percentage of Spending on Each Technology Over Total Budget",
       x = "Years",
       y = "Percentage of Total Budget") +
  scale_fill_discrete() +
  theme_minimal() +
  theme(legend.position = "bottom")
```